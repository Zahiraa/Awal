{% extends 'admin.html.twig' %}

{% block title %}Contenu
{% endblock %}

{% import 'macros/status_macros.html.twig' as status %}

{% block content %}
	<div
		class="flex-1 flex flex-col bg-gray-50 px-4">
		<!-- Header -->
		<header class="bg-white py-6 border-b border-gray-200">
			<div class="flex flex-wrap justify-between items-center gap-4 px-4">
				<div>
					<h1 class="text-2xl font-semibold text-gray-900">
						{{ contenu.title }}
					</h1>
					<div class="mt-2">
						{{ status.get_status(contenu.statut) }}
					</div>
				</div>
				<div class="flex items-center space-x-3">
					<a href="{{ path('app_contenu_index') }}" class="flex items-center cursor-pointer px-4 py-2 bg-white border border-light-gray-100 text-gray-700 rounded-lg hover:bg-gray-100 transition duration-150">
						Retour
					</a>
					<a href="{{ path('app_contenu_edit', {'id': contenu.id}) }}" class="flex items-center cursor-pointer px-4 py-2 bg-blue-50 border border-blue-100 text-blue-700 rounded-lg hover:bg-blue-100 transition duration-150">
						Modifier
					</a>

					{{ include('admin/contenu/_delete_form.html.twig') }}

				</div>
			</div>
		</header>

		<!-- Details Section -->
		<div class="p-6">
			<div class="bg-white rounded-lg shadow-sm p-6 mb-6">
				<div class="grid grid-cols-1 md:grid-cols-2 gap-6">

					<div class="md:col-span-2">
						<p class="text-sm font-medium text-gray-500">Titre</p>
						<p class="text-base text-gray-900">{{ contenu.title }}</p>
					</div>
					<div>
						<p class="text-sm font-medium text-gray-500">Date de création</p>
						<p class="text-base text-gray-900">{{ contenu.createdAt ? contenu.createdAt|date('Y-m-d H:i:s') : 'Non définie' }}</p>
					</div>
					<div>
						<p class="text-sm font-medium text-gray-500">Dernière mise à jour</p>
						<p class="text-base text-gray-900">{{ contenu.updatedAt ? contenu.updatedAt|date('Y-m-d H:i:s') : 'Non définie' }}</p>
					</div>
				</div>
			</div>

			<!-- Associated Content (ContenuNumeros) if any -->
			{% if contenu.contenuNumeros is defined and contenu.contenuNumeros|length > 0 %}
				<div class="bg-white rounded-lg shadow-sm p-6">
					<h2 class="text-lg font-semibold text-gray-900 mb-4">ملف العدد</h2>
					<ul class="list-disc pl-5 space-y-2">
						{% for cn in contenu.contenuNumeros %}
							<li class="text-gray-700">{{ cn.title }}</li>
						{% endfor %}
					</ul>
				</div>
			{% endif %}
		</div>
	</div>

	<!-- Publish Modal -->
	<div id="publishedModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden z-50">
		<div id="modalContent" class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
			<div class="flex justify-between items-start">
				<img src="{{ asset('build/images/icons/confirm.svg') }}" id="img-modal" class="w-12 h-12">
				<button id="close-publish-modal-btn" class="text-gray-400 hover:text-gray-600">
					<svg class="w-6 h-6" fill="currentColor" viewbox="0 0 20 20">
						<path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
					</svg>
				</button>
			</div>
			<div class="mt-3">
				<h3 class="text-lg font-medium text-gray-900">Confirmation</h3>
				<p class="text-sm text-gray-600 mb-6">Voulez-vous vraiment publier ce contenu ?</p>
				<div class="flex space-x-4">
					<button id="cancel-publish-modal-btn" class="px-4 py-2 flex-1 border border-light-gray-100 text-gray-800 text-base font-medium rounded-md hover:bg-gray-50 transition duration-150">
						Annuler
					</button>
					<button id="confirm-publish-btn" class="px-4 py-2 flex-1 bg-primary-600 text-white text-base font-medium rounded-md hover:bg-primary-700 transition duration-150">
						Confirmer
					</button>
				</div>
			</div>
		</div>
	</div>
{% endblock %}

{% block head_scripts %}
	<script>
		function initializePublishModal() {
let contenuToPublish = null;
let csrfTokenForPublish = null;

function showPublishModal(button) {
contenuToPublish = button.getAttribute('data-contenu-id');
csrfTokenForPublish = button.getAttribute('data-csrf-token');

const modal = document.getElementById('publishedModal');
if (modal) 
modal.classList.remove('hidden');



}

function hidePublishModal() {
const modal = document.getElementById('publishedModal');
if (modal) 
modal.classList.add('hidden');



contenuToPublish = null;
csrfTokenForPublish = null;
}

function publishItem() {
if (contenuToPublish && csrfTokenForPublish) { // Logic to publish - currently just logs as route might not exist
console.log('Publishing contenu:', contenuToPublish);
hidePublishModal();
}
}

const publishButtons = document.querySelectorAll('.publish-button');
publishButtons.forEach(button => {
button.addEventListener('click', function (e) {
e.preventDefault();
showPublishModal(this);
});
});

const confirmButton = document.getElementById('confirm-publish-btn');
if (confirmButton) {
confirmButton.addEventListener('click', function (e) {
e.preventDefault();
publishItem();
});
}

const closeModalButtons = [document.getElementById('close-publish-modal-btn'), document.getElementById('cancel-publish-modal-btn')];

closeModalButtons.forEach(btn => {
if (btn) {
btn.addEventListener('click', function (e) {
e.preventDefault();
hidePublishModal();
});
}
});
}

document.addEventListener('DOMContentLoaded', initializePublishModal);
document.addEventListener('turbo:load', initializePublishModal);
	</script>
{% endblock %}
