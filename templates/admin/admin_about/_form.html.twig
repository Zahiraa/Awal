{{ form_start(form, {'attr': {'class': 'mx-auto p-6 bg-white rounded-lg shadow-sm'}}) }}

{% set maxTaille = "5Mo" %}

<label class="flex-col mb-8 mt-4 flex items-center justify-center cursor-pointer pb-3 pt-3 px-4 md:px-0" style="border: 1px solid #E3EDF2">
    <img src="{{ asset('build/images/icons/upload.svg') }}" alt="User"  width="40" height="40" class="rounded-full m-w-">
    <!-- Icône upload -->
    <p class="text-gray-600 text-center mt-2 font-bold text-sm md:text-lg">
        <span class="text-pink-800">Cliquez pour télécharger une Image</span>
        <br/>
        SVG, PNG, JPG or GIF (max. 800x400px)<br>
        La taille de l'image ne doit pas dépasser {{ maxTaille }}
    </p>

    {{ form_row(form.image) }}

</label>

{% if image is defined and image is not empty %}

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-8 mb-4">
        <div class="rounded-2xl flex gap-4 justify-between p-2 w-full md:w-auto" style=" border: 1px solid #008780">
            <img id="image-preview" src="{{ '/uploads/' ~ image.name }}" class="w-20 h-20 max-w-20 max-h-20 rounded-xl object-contain" alt="Preview">
            <div class="flex flex-col items-start justify-center flex-1">
                <p id="file-name" class="text-gray-600 font-bold text-xs">{{ image.name }}</p>
                <p id="file-size" class="text-gray-600 font-bold text-xs">Size: {{ image.size ?? 'Unknown' }}</p>
            </div>
            <img src="{{ asset('build/images/icons/valid.svg') }}" class="w-5 h-5 rounded-2xl min-w-5 min-h-5 object-cover" alt="Valid">
        </div>
    </div>

{% else %}
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-8 mb-4">
        <div class="rounded-2xl flex gap-4 justify-between p-2 w-full md:w-auto"  style=" border: 1px solid #008780">
            <img id="image-preview" src="{{ asset('build/images/icons/upload.svg') }}" class="w-20 h-20 min-w-20 min-h-20 rounded-xl object-contain" alt="Preview">
            <div class="flex flex-col items-start justify-center flex-1">
                <p id="file-name" class="text-gray-600 font-bold text-xs">Aucun fichier sélectionné</p>
                <p id="file-size" class="text-gray-600 font-bold text-xs">Size: 0 KB</p>
            </div>
            <img id="img-valid" style="display: none" src="{{ asset('build/images/icons/valid.svg') }}" class="w-5 h-5 rounded-2xl min-w-5 min-h-5 object-cover" alt="Valid">
        </div>
    </div>
{% endif %}

<div class="flex flex-col gap-4">
    {{ form_row(form.title) }}
    {{ form_row(form.content) }}
</div>

<div class="flex flex-col md:flex-row items-start md:items-center mt-6 border-t pt-4 border-gray-300 gap-4 md:gap-0">
    <div class="flex flex-col md:flex-row w-full md:w-auto md:ml-auto space-y-3 md:space-y-0 md:space-x-3 gap-1">
        <a href="{{ path('app_admin_about_index') }}" type="button" class="w-full md:w-auto bg-white border border-gray-300 px-4 py-2 rounded-lg font-semibold flex items-center justify-center gap-2 text-lg text-gray-700 hover:bg-gray-50">
            Annuler
        </a>

        <button type="submit" name="{{ form.draft_button.vars.full_name }}"
                class="w-full md:w-auto {{ form.draft_button.vars.attr.class }} flex items-center justify-center">
            {{ form.draft_button.vars.label }}
            <!-- Icône disquette (save) -->
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M4.83333 1.5V4.33333C4.83333 4.80004 4.83333 5.0334 4.92416 5.21166C5.00406 5.36846 5.13154 5.49594 5.28834 5.57584C5.4666 5.66667 5.69996 5.66667 6.16667 5.66667H11.8333C12.3 5.66667 12.5334 5.66667 12.7117 5.57584C12.8685 5.49594 12.9959 5.36846 13.0758 5.21166C13.1667 5.0334 13.1667 4.80004 13.1667 4.33333V2.33333M13.1667 16.5V11.1667C13.1667 10.7 13.1667 10.4666 13.0758 10.2883C12.9959 10.1315 12.8685 10.0041 12.7117 9.92416C12.5334 9.83333 12.3 9.83333 11.8333 9.83333H6.16667C5.69996 9.83333 5.4666 9.83333 5.28834 9.92416C5.13154 10.0041 5.00406 10.1315 4.92416 10.2883C4.83333 10.4666 4.83333 10.7 4.83333 11.1667V16.5M16.5 6.77124V12.5C16.5 13.9001 16.5 14.6002 16.2275 15.135C15.9878 15.6054 15.6054 15.9878 15.135 16.2275C14.6002 16.5 13.9001 16.5 12.5 16.5H5.5C4.09987 16.5 3.3998 16.5 2.86502 16.2275C2.39462 15.9878 2.01217 15.6054 1.77248 15.135C1.5 14.6002 1.5 13.9001 1.5 12.5V5.5C1.5 4.09987 1.5 3.3998 1.77248 2.86502C2.01217 2.39462 2.39462 2.01217 2.86502 1.77248C3.3998 1.5 4.09987 1.5 5.5 1.5H11.2288C11.6364 1.5 11.8402 1.5 12.0321 1.54605C12.2021 1.58688 12.3647 1.65422 12.5138 1.7456C12.682 1.84867 12.8261 1.9928 13.1144 2.28105L15.719 4.88562C16.0072 5.17387 16.1513 5.318 16.2544 5.48619C16.3458 5.63531 16.4131 5.79789 16.4539 5.96795C16.5 6.15976 16.5 6.36358 16.5 6.77124Z" stroke="#069490" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>

        <button type="submit" name="{{ form.publish_button.vars.full_name }}"
                class="w-full md:w-auto {{ form.publish_button.vars.attr.class }} flex items-center justify-center">
            {{ form.publish_button.vars.label }}
            <!-- Icône export (external link) -->
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M16.5 6.50001L16.5 1.50001M16.5 1.50001H11.5M16.5 1.50001L9 9M7.33333 1.5H5.5C4.09987 1.5 3.3998 1.5 2.86502 1.77248C2.39462 2.01217 2.01217 2.39462 1.77248 2.86502C3.3998 1.5 4.09987 1.5 5.5 1.5H11.2288C11.6364 1.5 11.8402 1.5 12.0321 1.54605C12.2021 1.58688 12.3647 1.65422 12.5138 1.7456C12.682 1.84867 12.8261 1.9928 13.1144 2.28105L15.719 4.88562C16.0072 5.17387 16.1513 5.318 16.2544 5.48619C16.3458 5.63531 16.4131 5.79789 16.4539 5.96795C16.5 6.15976 16.5 6.36358 16.5 6.77124Z" stroke="white" stroke-width="1.66667" stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
        </button>
    </div>
</div>

{{ form_row(form._token ) }}
{{ form_end(form, {'render_rest': false}) }}

<div id="imageModal" class="fixed inset-0 bg-modal overflow-y-auto h-full w-full hidden z-50 modal-backdrop">
    <div id="modalContent" class="relative top-1/4 mx-auto p-4 md:p-5 modal-box-shadow w-11/12 max-w-sm md:w-96 rounded-md bg-white modal-content">
        <div class="flex justify-between items-start">
            <img src="{{ asset('build/images/icons/danger.svg') }}" alt="Supprimer" class="w-10 h-10 md:w-12 md:h-12">
            <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600 hover:cursor-pointer">
                <svg class="w-5 h-5 md:w-6 md:h-6" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                </svg>
            </button>
        </div>
        <div class="mt-3">
            <h3 class="text-base md:text-lg font-medium text-gray-900">L'image dépasse la taille limite de {{ maxTaille }}</h3>
            <p class="text-xs md:text-sm text-gray-600 mb-4 md:mb-6">L'image que vous avez choisie est trop grande. Veuillez choisir une image plus petite.</p>
            <div class="flex flex-col md:flex-row space-y-2 md:space-y-0 md:space-x-4">
            </div>
        </div>
    </div>
</div>

<script>
    (function() {
        const fileInput = document.getElementById('{{ form.image.vars.id }}');
        const preview = document.getElementById('image-preview');

        const imageModal = document.getElementById('imageModal');
        const closeBtn = document.getElementById('close-modal-btn');
        if (closeBtn) {
            closeBtn.addEventListener('click', function (e) {
                const modalContent = document.getElementById('modalContent');
                if (!imageModal || !modalContent) return;

                imageModal.classList.remove('modal-entered');
                imageModal.classList.add('modal-exiting');
                modalContent.classList.remove('modal-entered');
                modalContent.classList.add('modal-exiting');

                setTimeout(() => {
                    imageModal.style.display = 'none';
                    imageModal.classList.remove('modal-exiting');
                    modalContent.classList.remove('modal-exiting');
                }, 300);
            });
        }

        fileInput.addEventListener('change', function(event) {
            const file = event.target.files[0];

            if (file && file.type.startsWith('image/')) {

                const fileName = file.name;
                const fileSizeKB = (file.size / 1024).toFixed(2);
                const fileSizeMB = (file.size / (1024 * 1024)).toFixed(2);
                const limit = 5;
                // afficher popup si file est trop gros
                if(fileSizeMB >= limit) {
                    const imgValid = document.getElementById('img-valid');
                    imgValid.style.display = 'none';
                    imageModal.style.display = 'block';
                    return;
                }else{
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.src = e.target.result;
                        preview.style.display = 'block';
                    };
                    reader.readAsDataURL(file);

                    document.getElementById('file-name').textContent = fileName;
                    document.getElementById('file-size').textContent = `Size: ${fileSizeKB} KB`;
                    const imgValid = document.getElementById('img-valid');
                    imgValid.style.display = 'block';
                    imgValid.src = '{{ asset('build/images/icons/valid.svg') }}';
                }


            }
        });

    })();
</script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote-lite.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.9.0/dist/summernote-lite.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <script defer>
        const initSummernote = () => {
            if (typeof $ === 'undefined') {
                setTimeout(initSummernote, 100);
                return;
            }

            const element = $('#about_form_content');
            if (element.length === 0) {
                setTimeout(initSummernote, 100);
                return;
            }

            if (element.hasClass('note-editable')) {
                element.summernote('destroy');
            }
            element.summernote({
                height: 300,
                tabsize: 2,
                toolbar: [
                    ['font', ['bold', 'underline', 'clear', 'italic', 'strikethrough']],
                    ['style', ['style']],
                    ['color', ['color']],
                    ['para', ['ul', 'ol', 'paragraph']],
                    ['table', ['table']],
                    ['insert', ['link', 'picture', 'video']],
                    ['view', ['codeview', 'help']]
                ]
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            initSummernote();
        });

        document.addEventListener('turbo:load', () => {
            initSummernote();
        });

        document.addEventListener('turbo:render', () => {
            initSummernote();
        });
    </script>